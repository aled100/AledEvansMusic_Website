---
import site from '../content/site.json';

// De-duplicate nav items by URL (safety, in case JSON ever has dupes)
const uniqueNav = Array.from(new Map(site.nav.map(i => [i.url, i])).values());
---

<header id="site-header" class="fixed top-0 left-0 w-full transition-all duration-300 z-50">
  <div class="container flex items-center justify-between py-4">
    <!-- Logo / Brand -->
    <a href="/" class="text-lg font-serif tracking-tight flex items-center gap-2">
      <img src={site.hero.logo} alt="Logo" class="h-8 w-8 md:h-10 md:w-10 rounded-full" />
      <span>{site.brandName}</span>
    </a>

    <!-- Desktop Nav -->
    <nav class="hidden md:flex gap-6 text-sm font-medium">
      {uniqueNav.map((item) => (
        <a href={item.url} class="hover:text-primary">{item.label}</a>
      ))}
    </nav>

    <!-- Mobile Hamburger -->
    <button 
      id="menu-btn"
      class="md:hidden flex flex-col justify-between w-6 h-5 focus:outline-none relative z-50"
      aria-label="Toggle menu"
    >
      <span class="block w-full h-0.5 bg-black transition-transform duration-300 origin-center"></span>
      <span class="block w-full h-0.5 bg-black transition-opacity duration-300"></span>
      <span class="block w-full h-0.5 bg-black transition-transform duration-300 origin-center"></span>
    </button>
  </div>
</header>

<!-- Slide-in Mobile Menu (hidden by default) -->
<div 
  id="mobile-menu" 
  class="hidden md:hidden fixed top-0 right-0 h-full w-64 bg-white shadow-lg transform translate-x-full transition-transform duration-300 ease-in-out z-40 flex flex-col p-6"
>
  {uniqueNav.map((item) => (
    <a href={item.url} class="py-2 text-lg border-b border-gray-200">{item.label}</a>
  ))}
</div>

<!-- Overlay -->
<div id="overlay" class="hidden fixed inset-0 bg-black/50 z-30"></div>

<script>
  const header = document.getElementById('site-header');
  const menuBtn = document.getElementById('menu-btn');
  const bars = menuBtn.querySelectorAll('span');
  const menu = document.getElementById('mobile-menu');
  const overlay = document.getElementById('overlay');

  // Shrink header on scroll
  window.addEventListener('scroll', () => {
    if (window.scrollY > 40) {
      header.classList.add('bg-white/90', 'shadow-md', 'py-2');
      header.classList.remove('bg-transparent', 'py-4');
    } else {
      header.classList.add('bg-transparent', 'py-4');
      header.classList.remove('bg-white/90', 'shadow-md', 'py-2');
    }
  });

  function openMenu() {
    menu.classList.remove('hidden', 'translate-x-full');
    overlay.classList.remove('hidden');
    // Animate hamburger → X
    bars[0].classList.add('rotate-45', 'translate-y-1.5');
    bars[1].classList.add('opacity-0');
    bars[2].classList.add('-rotate-45', '-translate-y-1.5');
  }

  function closeMenu() {
    menu.classList.add('translate-x-full');
    overlay.classList.add('hidden');
    // Animate X → hamburger
    bars[0].classList.remove('rotate-45', 'translate-y-1.5');
    bars[1].classList.remove('opacity-0');
    bars[2].classList.remove('-rotate-45', '-translate-y-1.5');
    // Hide after the slide-out transition ends (300ms)
    setTimeout(() => menu.classList.add('hidden'), 300);
  }

  let open = false;
  menuBtn.addEventListener('click', () => (open ? closeMenu() : (open = true, openMenu())));
  overlay.addEventListener('click', () => { open = false; closeMenu(); });
  // Close when a mobile link is clicked
  menu.querySelectorAll('a').forEach(a => a.addEventListener('click', () => { open = false; closeMenu(); }));
</script>
