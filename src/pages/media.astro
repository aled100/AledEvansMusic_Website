---
import Base from '../layouts/BaseLayout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import site from '../content/site.json';

// Normalize any YouTube URL to an embeddable form
const toEmbed = (raw) => {
  try {
    const u = new URL(raw);
    let id = '';

    if (u.hostname.includes('youtu.be')) {
      // https://youtu.be/VIDEOID
      id = u.pathname.replace('/', '');
    } else if (u.hostname.includes('youtube.com')) {
      if (u.pathname.startsWith('/shorts/')) {
        // https://youtube.com/shorts/VIDEOID
        id = u.pathname.split('/')[2] || u.pathname.split('/')[1];
      } else if (u.searchParams.get('v')) {
        // https://www.youtube.com/watch?v=VIDEOID
        id = u.searchParams.get('v');
      }
    }

    return id ? `https://www.youtube.com/embed/${id}` : raw;
  } catch {
    return raw;
  }
};
---

<Base title="Media â€” Aled Evans" description={site.metaDescription}>
  <Header />
  <main class="section">
    <div class="container">
      <h1 class="h2 font-serif mb-4">Photo Gallery</h1>
      <div class="grid grid-cols-2 md:grid-cols-3 gap-3 mb-12">
        {site.media.gallery.map((g) => (
          <img src={g} alt="Gallery image" class="w-full h-52 object-cover rounded-md ring-1 ring-coal/10" />
        ))}
      </div>

      <h2 class="h2 font-serif mb-4">Videos</h2>
      <div class="grid md:grid-cols-2 gap-6">
        {site.media.videos.map((v) => {
          const src = toEmbed(v.url);
          return (
            <div class="w-full rounded-md ring-1 ring-coal/10 overflow-hidden" style="aspect-ratio: 16 / 9;">
              <iframe
                class="w-full h-full"
                src={src}
                title={v.title}
                loading="lazy"
                allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                allowfullscreen
                referrerpolicy="strict-origin-when-cross-origin"
              ></iframe>
              <div class="small p-2">{v.title}</div>
            </div>
          );
        })}
      </div>
    </div>
  </main>
  <Footer />
</Base>
